<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Lab Inventory System</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ===== GENERAL ===== */
    * { box-sizing:border-box; margin:0; padding:0; font-family:'Poppins',sans-serif;}
    body { background: linear-gradient(135deg,#001f4d,#003366); color:#fff; min-height:100vh;}
    
    /* ===== SIDEBAR ===== */
    .sidebar { width:220px; position:fixed; top:0; left:0; height:100%; background: rgba(0,0,0,0.85); padding-top:30px;}
    .sidebar .logo { text-align:center; font-size:24px; font-weight:bold; margin-bottom:20px; color:#ffd700;}
    .sidebar ul { list-style:none; padding-left:0;}
    .sidebar ul li { padding:15px 20px;}
    .sidebar ul li a { color:#fff; text-decoration:none; display:block; transition:0.3s;}
    .sidebar ul li a:hover, .sidebar ul li.active a { background:#ffd700; color:#003366; border-radius:8px;}
    
    /* ===== MAIN CONTENT ===== */
    .main-content { margin-left:220px; padding:20px;}
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
    header h1 { font-size:24px; color:#ffd700;}
    .profile-name { margin-bottom:20px; font-weight:bold; color:#ffd700; }
    
    /* ===== TABLES ===== */
    table { width:100%; border-collapse:collapse; margin-bottom:30px; border-radius:12px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.3); background:rgba(255,255,255,0.05);}
    table th, table td { padding:12px 15px; text-align:left;}
    table th { background:rgba(255,215,0,0.8); color:#003366; font-weight:bold;}
    table tr:nth-child(even) { background: rgba(255,255,255,0.1);}
    table tr:hover { background: rgba(255,255,255,0.2); transition:0.3s;}
    
    /* ===== BUTTONS ===== */
    button { padding:10px 18px; font-size:14px; font-weight:bold; color:#003366; background:linear-gradient(135deg,#ffd700,#ffcc00); border:none; border-radius:10px; cursor:pointer; transition:0.3s;}
    button:hover { background: linear-gradient(135deg,#fff,#ffd700); transform:translateY(-2px);}
    #logoutBtn, #viewDashboardBtn, #toggleAddLesson { margin:10px 5px;}
    
    /* ===== ADD LESSON FORM ===== */
    #addLessonForm { display:none; background: rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-bottom:20px;}
    #addLessonForm input { width:100%; margin-bottom:10px; padding:10px; border-radius:8px; border:none;}
    
    /* ===== CHARTS ===== */
    .charts-container { display:flex; gap:20px; flex-wrap:wrap; margin-bottom:30px;}
    canvas { background: rgba(255,255,255,0.05); border-radius:12px; padding:15px;}
    
    /* ===== RESPONSIVE ===== */
    @media(max-width: 768px){
      .sidebar { width:60px;}
      .main-content { margin-left:60px;}
    }
    @media(max-width:600px){
      table, thead, tbody, th, td, tr { display:block;}
      table thead { display:none;}
      table tr { margin-bottom:15px; background: rgba(255,255,255,0.1); padding:15px; border-radius:10px;}
      table td { text-align:right; padding-left:50%; position:relative;}
      table td::before { content:attr(data-label); position:absolute; left:15px; width:45%; text-align:left; font-weight:bold; color:#ffd700;}
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="logo">ðŸ§  LabSystem</div>
    <ul>
      <li class="active"><a href="dashboard.html">Dashboard</a></li>
      <li><a href="#">Inventory</a></li>
      <li><a href="teachers.html">Teachers</a></li>
      <li><a href="#">Reports</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <div class="profile-name">Welcome, <span id="userName"></span></div>
    <header>
      <h1>Lab Management Dashboard</h1>
      <div>
        <button id="toggleAddLesson">âž• Add Lesson</button>
        <button id="viewDashboardBtn">Refresh Dashboard</button>
        <button id="logoutBtn">Logout</button>
      </div>
    </header>

    <!-- Add Lesson Form -->
    <div id="addLessonForm">
      <input type="text" id="lessonClass" placeholder="Class" required>
      <input type="text" id="lessonProject" placeholder="Project" required>
      <input type="date" id="lessonDate" required>
      <input type="text" id="lessonTeacher" placeholder="Teacher" required>
      <input type="number" id="lessonStudents" placeholder="Number of Students">
      <button id="saveLessonBtn">Save Lesson</button>
    </div>

    <!-- Current Lessons -->
    <h2 class="section-title">ðŸŸ¢ Current Lessons</h2>
    <table id="currentLessons">
      <thead>
        <tr>
          <th>Date</th>
          <th>Class</th>
          <th>Project</th>
          <th>Teacher</th>
          <th>Students</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Next Lessons -->
    <h2 class="section-title">ðŸŸ¡ Next Lessons</h2>
    <table id="nextLesson">
      <thead>
        <tr>
          <th>Date</th>
          <th>Class</th>
          <th>Project</th>
          <th>Teacher</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Upcoming Lessons -->
    <h2 class="section-title">ðŸ”µ Upcoming Lessons</h2>
    <table id="upcomingLessons">
      <thead>
        <tr>
          <th>Date</th>
          <th>Class</th>
          <th>Project</th>
          <th>Teacher</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Charts -->
    <h2 class="section-title">ðŸ“Š Inventory Overview</h2>
    <div class="charts-container">
      <canvas id="barChart" width="350" height="200"></canvas>
      <canvas id="pieChart" width="350" height="200"></canvas>
    </div>
  </div>

  <!-- JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ===== FIREBASE CONFIG =====
    const firebaseConfig = {
      apiKey: "AIzaSyDe9fXCUSpTFw0VSq_ppzRqOjhkCDIHDXY",
      authDomain: "lab-management-system-9a96e.firebaseapp.com",
      projectId: "lab-management-system-9a96e",
      storageBucket: "lab-management-system-9a96e.appspot.com",
      messagingSenderId: "460300647867",
      appId: "1:460300647867:web:2a626aced15605dd63989e"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== ADMIN CHECK =====
    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
    if(!loggedInUser || loggedInUser.role !== 'admin'){
      alert('Access denied. Please log in as admin.');
      window.location.href = 'login.html';
    } else {
      document.getElementById('userName').textContent = loggedInUser.name;
    }

    // ===== LOGOUT =====
    document.getElementById('logoutBtn').addEventListener('click', async ()=>{
      localStorage.removeItem('loggedInUser');
      await signOut(auth);
      window.location.href = 'login.html';
    });

    // ===== TOGGLE ADD LESSON FORM =====
    document.getElementById('toggleAddLesson').addEventListener('click', ()=>{
      const form = document.getElementById('addLessonForm');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    });

    // ===== SAVE LESSON =====
    document.getElementById('saveLessonBtn').addEventListener('click', async ()=>{
      const lesson = {
        class: document.getElementById('lessonClass').value,
        project: document.getElementById('lessonProject').value,
        date: document.getElementById('lessonDate').value,
        teacher: document.getElementById('lessonTeacher').value,
        students: parseInt(document.getElementById('lessonStudents').value) || 0
      };
      try{
        await addDoc(collection(db,'lessons'), lesson);
        alert('âœ… Lesson added successfully!');
        loadLessons();
      } catch(err){
        alert('âŒ Error adding lesson: '+err.message);
      }
    });

    // ===== LOAD LESSONS =====
    async function loadLessons(){
      const today = new Date();
      const currentTable = document.querySelector('#currentLessons tbody');
      const nextTable = document.querySelector('#nextLesson tbody');
      const upcomingTable = document.querySelector('#upcomingLessons tbody');

      currentTable.innerHTML = '';
      nextTable.innerHTML = '';
      upcomingTable.innerHTML = '';

      const querySnapshot = await getDocs(collection(db,'lessons'));
      querySnapshot.forEach(doc=>{
        const lesson = doc.data();
        const lessonDate = new Date(lesson.date);
        const row = `
          <tr>
            <td data-label="Date">${lesson.date}</td>
            <td data-label="Class">${lesson.class}</td>
            <td data-label="Project">${lesson.project}</td>
            <td data-label="Teacher">${lesson.teacher}</td>
            <td data-label="Students">${lesson.students || '-'}</td>
            <td data-label="Actions"><button>Edit</button></td>
          </tr>
        `;
        if(lessonDate.toDateString() === today.toDateString()) currentTable.innerHTML += row;
        else if(lessonDate > today && lessonDate - today <= 86400000) nextTable.innerHTML += row;
        else if(lessonDate > today) upcomingTable.innerHTML += row;
      });
    }

    // ===== VIEW DASHBOARD BUTTON =====
    document.getElementById('viewDashboardBtn').addEventListener('click', loadLessons);

    // Load on page load
    loadLessons();

    // ===== CHARTS =====
    const barCtx = document.getElementById('barChart').getContext('2d');
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    new Chart(barCtx,{ type:'bar', data:{ labels:['Grade7','Grade8','Grade9'], datasets:[{ label:'Students', data:[24,20,15], backgroundColor:'#ffd700'}]}, options:{}});
    new Chart(pieCtx,{ type:'pie', data:{ labels:['Raspberry Pi','Smart Traffic','AI Weather'], datasets:[{ data:[5,3,2], backgroundColor:['#ffd700','#ffcc00','#ffaa00'] }]}, options:{}});
  </script>
</body>
</html>
